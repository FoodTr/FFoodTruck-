<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FFoodTrucks PRO - Studio Produit</title>

<style>
    :root { --primary: #FF3B30; --bg: #121212; --card: #1e1e1e; }
    
    body { 
        font-family: -apple-system, sans-serif; 
        margin: 0; background: var(--bg); color: white; 
        display: flex; justify-content: center; min-height: 100vh;
    }

    .main-wrapper { 
        width: 100%; max-width: 700px; padding: 20px; box-sizing: border-box; 
        padding-bottom: 100px; background: var(--bg);
        border-left: 1px solid #333; border-right: 1px solid #333;
    }

    .header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .back-btn { font-size: 24px; cursor: pointer; border: 1px solid #333; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 15px; background: var(--card); }
    
    label { display: block; color: var(--primary); font-size: 11px; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

    /* --- CAMERA & IA --- */
    .ia-camera-box { width: 100%; height: 260px; background: var(--card); border: 2px dashed var(--primary); border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; margin-bottom: 30px; }
    .ai-status-badge { position: absolute; top: 15px; left: 15px; background: var(--primary); padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; z-index: 10; }
    #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
    .ai-loader { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.85); flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .scan-line { width: 100%; height: 3px; background: var(--primary); position: absolute; top: 0; animation: scan 1.5s infinite linear; box-shadow: 0 0 15px var(--primary); }
    @keyframes scan { from { top: 0; } to { top: 100%; } }

    /* --- SYSTÃˆME DE MENUS CÃ”TE Ã€ CÃ”TE --- */
    .filters-row { display: flex; gap: 10px; margin-bottom: 25px; }
    .filter-section { flex: 1; position: relative; }
    
    .filter-header { 
        display: flex; justify-content: space-between; align-items: center; 
        padding: 15px 12px; cursor: pointer; font-weight: 800; font-size: 11px; 
        color: #fff; background: var(--card); border: 1px solid #333; border-radius: 15px;
    }

    .filter-content { 
        display: none; flex-wrap: wrap; gap: 8px; padding: 15px; 
        position: absolute; top: 110%; left: 0; width: 200%; 
        background: #252525; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        z-index: 3000; border: 1px solid #444; max-height: 350px; overflow-y: auto;
    }
    #sec-labels .filter-content { left: auto; right: 0; width: 180%; }
    .filter-content.open { display: flex; }
    
    .group-title { width: 100%; font-size: 10px; color: var(--primary); font-weight: 900; margin: 10px 0 5px 0; border-bottom: 1px solid #333; padding-bottom: 3px; }
    .arrow { transition: 0.3s; font-size: 8px; color: #666; }
    .open-section .arrow { transform: rotate(180deg); }

    .pref-chip { 
        padding: 8px 14px; border-radius: 12px; border: 1px solid #444; 
        background: #1e1e1e; font-size: 12px; font-weight: bold; color: #888; cursor: pointer; 
    }
    .pref-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* --- INPUTS --- */
    .main-input { width: 100%; background: var(--card); border: 1px solid #333; padding: 20px; border-radius: 15px; color: white; font-size: 18px; box-sizing: border-box; outline: none; margin-bottom: 20px; }
    .btn-publish { background: var(--primary); color: white; border: none; width: 100%; padding: 25px; border-radius: 20px; font-size: 22px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 59, 48, 0.3); transition: 0.2s; }
</style>

</head>
<body>

<div class="main-wrapper">
    <div class="header">
        <div class="back-btn" id="btn-back">â†</div>
        <h2 style="margin:0; font-weight: 900; font-style: italic;">STUDIO FFoodTrucks</h2>
    </div>

<label>Rendu visuel IA</label>
<div class="ia-camera-box" id="ia-box">
    <div class="ai-status-badge">âœ¨ IA OPTIMISEUR</div>
    <div id="instruction">
        <span style="font-size: 50px;">ğŸ“¸</span><br>
        <span style="font-size: 12px; color: #888; margin-top: 10px; display: block; text-align: center;">Photo brute du plat</span>
    </div>
    <img id="preview-img">
    <div id="ai-processing" class="ai-loader">
        <div class="scan-line"></div>
        <div style="font-weight: bold; color: var(--primary); letter-spacing: 2px;">TRAITEMENT IA...</div>
    </div>
</div>

<label>Classification du produit</label>
<div class="filters-row">
    <div class="filter-section" id="sec-cuisine">
        <div class="filter-header" onclick="toggleFilter('cuisine-content', 'sec-cuisine')">
            <span id="selected-cat-label">ğŸ” CUISINES</span>
            <span class="arrow">â–¼</span>
        </div>
        <div id="cuisine-content" class="filter-content">
            <div class="group-title">POPULAIRE</div>
            <div class="pref-chip" onclick="selectCat('ğŸ” Burgers')">ğŸ” Burgers</div>
            <div class="pref-chip" onclick="selectCat('ğŸ¥© Smash')">ğŸ¥© Smash</div>
            <div class="pref-chip" onclick="selectCat('ğŸ• Pizzas')">ğŸ• Pizzas</div>
            
            <div class="group-title">TERROIR & EUROPE</div>
            <div class="pref-chip" onclick="selectCat('ğŸ‡«ğŸ‡· FranÃ§ais')">ğŸ‡«ğŸ‡· FranÃ§ais</div>
            <div class="pref-chip" onclick="selectCat('ğŸ¥ CrÃªpes')">ğŸ¥ CrÃªpes</div>
            <div class="pref-chip" onclick="selectCat('ğŸ¥¨ Terroir')">ğŸ¥¨ Terroir</div>
            <div class="pref-chip" onclick="selectCat('ğŸ Italien')">ğŸ Italien</div>
            <div class="pref-chip" onclick="selectCat('ğŸ‡ªğŸ‡¸ Tapas')">ğŸ‡ªğŸ‡¸ Tapas</div>

            <div class="group-title">MONDE</div>
            <div class="pref-chip" onclick="selectCat('ğŸŒ® Mexicain')">ğŸŒ® Mexicain</div>
            <div class="pref-chip" onclick="selectCat('ğŸ± Japonais')">ğŸ± Japonais</div>
            <div class="pref-chip" onclick="selectCat('ğŸ¥¢ Vietnamien')">ğŸ¥¢ Vietnamien</div>
            <div class="pref-chip" onclick="selectCat('ğŸ› Indien')">ğŸ› Indien</div>
            <div class="pref-chip" onclick="selectCat('ğŸ¥™ Libanais')">ğŸ¥™ Libanais</div>
            <div class="pref-chip" onclick="selectCat('ğŸï¸ Antillais')">ğŸï¸ Antillais</div>
            <div class="pref-chip" onclick="selectCat('ğŸŒ Africain')">ğŸŒ Africain</div>

            <div class="group-title">AUTRES</div>
            <div class="pref-chip" onclick="selectCat('ğŸ© Desserts')">ğŸ© Desserts</div>
            <div class="pref-chip" onclick="selectCat('â˜• CafÃ©')">â˜• CafÃ©</div>
        </div>
    </div>

    <div class="filter-section" id="sec-labels">
        <div class="filter-header" onclick="toggleFilter('labels-content', 'sec-labels')">
            <span>ğŸŒ¿ LABELS</span>
            <span class="arrow">â–¼</span>
        </div>
        <div id="labels-content" class="filter-content">
            <div class="group-title">RÃ‰GIMES</div>
            <div class="pref-chip label-opt" data-val="ğŸŒ¿ VEGAN">ğŸŒ¿ Vegan</div>
            <div class="pref-chip label-opt" data-val="ğŸ¥— VEGGIE">ğŸ¥— Veggie</div>
            <div class="pref-chip label-opt" data-val="ğŸ¥© HALAL">ğŸ¥© Halal</div>
            <div class="pref-chip label-opt" data-val="ğŸ• CASHER">ğŸ• Casher</div>
            <div class="pref-chip label-opt" data-val="ğŸŒ¾ SANS GLUTEN">ğŸŒ¾ Sans Gluten</div>
            
            <div class="group-title">PROMESSE</div>
            <div class="pref-chip label-opt" data-val="ğŸ  MAISON">ğŸ  Maison</div>
            <div class="pref-chip label-opt" data-val="ğŸ“ LOCAL">ğŸ“ Local</div>
            <div class="pref-chip label-opt" data-val="ğŸŒ¶ï¸ Ã‰PICÃ‰">ğŸŒ¶ï¸ Ã‰picÃ©</div>
        </div>
    </div>
</div>

<label>Nom du plat</label>
<input type="text" id="p-name" class="main-input" placeholder="ex: Le Double Bacon Cheese">

<label>Prix (â‚¬)</label>
<input type="number" id="p-price" step="0.50" class="main-input" placeholder="12.00">

<label>Recette & IngrÃ©dients</label>
<textarea id="p-desc" class="main-input" rows="3" placeholder="DÃ©taillez votre prÃ©paration..."></textarea>

<button id="btn-pub" class="btn-publish">AJOUTER Ã€ LA CARTE</button>

</div>

<script type="module">
    import { auth, db, ts } from './firebase-config.js';
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    let selectedCat = "";
    let selectedLabels = [];
    let currentImg = "";

    // Toggle Menus
    window.toggleFilter = (contentId, sectionId) => {
        const content = document.getElementById(contentId);
        const section = document.getElementById(sectionId);
        const isOpen = content.classList.contains('open');
        document.querySelectorAll('.filter-content').forEach(c => c.classList.remove('open'));
        document.querySelectorAll('.filter-section').forEach(s => s.classList.remove('open-section'));
        if (!isOpen) {
            content.classList.add('open');
            section.classList.add('open-section');
        }
    };

    // SÃ©lection CatÃ©gorie unique
    window.selectCat = (cat) => {
        selectedCat = cat;
        document.getElementById('selected-cat-label').innerText = cat;
        document.querySelectorAll('#cuisine-content .pref-chip').forEach(c => c.classList.remove('active'));
        event.target.classList.add('active');
        toggleFilter('cuisine-content', 'sec-cuisine'); // Ferme aprÃ¨s sÃ©lection
    };

    // SÃ©lection Labels multiples
    document.querySelectorAll('.label-opt').forEach(opt => {
        opt.onclick = function() {
            this.classList.toggle('active');
            const val = this.getAttribute('data-val');
            if (selectedLabels.includes(val)) {
                selectedLabels = selectedLabels.filter(l => l !== val);
            } else {
                selectedLabels.push(val);
            }
        };
    });

    // IA Photo (Simulation)
    document.getElementById('ia-box').onclick = function() {
        const loader = document.getElementById('ai-processing');
        const preview = document.getElementById('preview-img');
        loader.style.display = 'flex';
        setTimeout(() => {
            loader.style.display = 'none';
            document.getElementById('instruction').style.display = 'none';
            preview.style.display = 'block';
            currentImg = "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=500";
            preview.src = currentImg;
        }, 1500);
    };

    // Publication
    document.getElementById('btn-pub').onclick = async function() {
        const user = auth.currentUser;
        if (!user) return alert("Session expirÃ©e.");

        const name = document.getElementById('p-name').value.trim();
        const price = document.getElementById('p-price').value;

        if (!name || !price || !selectedCat) return alert("ComplÃ©tez le nom, le prix et la catÃ©gorie !");

        this.disabled = true;
        this.innerText = "PUBLICATION...";

        try {
            await addDoc(collection(db, "menu"), {
                truckId: user.uid,
                name,
                price: parseFloat(price),
                desc: document.getElementById('p-desc').value,
                category: selectedCat,
                labels: selectedLabels,
                image: currentImg || "https://via.placeholder.com/150",
                stock: true,
                createdAt: ts()
            });
            window.location.href = 'gerant_carte.html';
        } catch (e) {
            alert("Erreur");
            this.disabled = false;
        }
    };

    document.getElementById('btn-back').onclick = () => window.location.href = 'gerant_dashboard.html';
</script>

</body>
</html>
