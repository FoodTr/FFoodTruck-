<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FFoodTrucks PRO - Studio Produit</title>

<style>
    /* --- CSS OPTIMIS√â --- */
    body { 
        font-family: -apple-system, sans-serif; 
        margin: 0; 
        background: #121212; 
        color: white; 
        display: flex;
        justify-content: center;
        min-height: 100vh;
    }

    .main-wrapper { 
        width: 100%;
        max-width: 700px; 
        padding: 20px; 
        box-sizing: border-box; 
        padding-bottom: 100px; 
        background: #121212;
        border-left: 1px solid #333;
        border-right: 1px solid #333;
    }

    .header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .back-btn { font-size: 24px; cursor: pointer; border: 1px solid #333; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 15px; background: #1e1e1e; }
    
    .ia-camera-box { width: 100%; height: 260px; background: #1e1e1e; border: 2px dashed #FF3B30; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; margin-bottom: 30px; }
    .ai-status-badge { position: absolute; top: 15px; left: 15px; background: #FF3B30; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; z-index: 10; }
    #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
    
    .ai-loader { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.85); flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .scan-line { width: 100%; height: 3px; background: #FF3B30; position: absolute; top: 0; animation: scan 1.5s infinite linear; box-shadow: 0 0 15px #FF3B30; }
    @keyframes scan { from { top: 0; } to { top: 100%; } }
    
    label { display: block; color: #FF3B30; font-size: 11px; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
    
    .cat-search-input { width: 100%; background: #1e1e1e; border: 1px solid #333; padding: 18px; border-radius: 15px; color: white; font-size: 16px; box-sizing: border-box; margin-bottom: 10px; outline: none; }
    .category-selector { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 25px; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
    .cat-chip { flex: 0 0 auto; padding: 12px 20px; background: #1e1e1e; border: 1px solid #444; border-radius: 15px; font-size: 14px; font-weight: bold; color: #888; cursor: pointer; transition: 0.2s; }
    .cat-chip.active { background: #FF3B30; color: white; border-color: #FF3B30; }
    
    .labels-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px; }
    .label-box { padding: 15px; border: 2px solid #333; border-radius: 15px; text-align: center; font-weight: bold; font-size: 13px; color: #666; cursor: pointer; }
    .label-box.selected { border-color: #4CAF50; color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
    
    .main-input { width: 100%; background: #1e1e1e; border: 1px solid #333; padding: 20px; border-radius: 15px; color: white; font-size: 18px; box-sizing: border-box; outline: none; margin-bottom: 20px; }
    .btn-publish { background: #FF3B30; color: white; border: none; width: 100%; padding: 25px; border-radius: 20px; font-size: 22px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 59, 48, 0.3); transition: 0.2s; }
</style>

</head>
<body>

<div class="main-wrapper">
    <div class="header">
        <div class="back-btn" id="btn-back">‚Üê</div>
        <h2 style="margin:0; font-weight: 900; font-style: italic;">STUDIO FFoodTrucks</h2>
    </div>

<label>Rendu visuel IA</label>
<div class="ia-camera-box" id="ia-box">
    <div class="ai-status-badge">‚ú® IA OPTIMISEUR</div>
    <div id="instruction" style="text-align:center;">
        <span style="font-size: 50px;">üì∏</span><br>
        <span style="font-size: 12px; color: #888; margin-top: 10px; display: block;">Prendre la photo brute du plat</span>
    </div>
    <img id="preview-img">
    <div id="ai-processing" class="ai-loader">
        <div class="scan-line"></div>
        <div style="font-weight: bold; color: #FF3B30; letter-spacing: 2px;">TRAITEMENT IA EN COURS...</div>
        <div style="font-size: 11px; color: #666; margin-top: 5px;">Nettoyage du fond & √âclairage studio</div>
    </div>
</div>

<label>Cat√©gorie de produit</label>
<input type="text" id="cat-search" class="cat-search-input" placeholder="üîç Chercher une sp√©cialit√©...">
<div class="category-selector" id="cat-container"></div>

<label>Labels Alimentaires</label>
<div class="labels-grid" id="labels-container">
    <div class="label-box">üåø VEGAN</div>
    <div class="label-box">ü•ó V√âG√âTARIEN</div>
    <div class="label-box">ü•© HALAL</div>
    <div class="label-box">üåæ SANS GLUTEN</div>
    <div class="label-box">üå∂Ô∏è √âPIC√â</div>
    <div class="label-box">üè† MAISON</div>
</div>

<label>Nom du plat</label>
<input type="text" id="p-name" class="main-input" placeholder="ex: Le Double Bacon Cheese">

<label>Prix de vente (‚Ç¨)</label>
<input type="number" id="p-price" step="0.50" class="main-input" placeholder="12.00">

<label>Description & Ingr√©dients</label>
<textarea id="p-desc" class="main-input" rows="3" style="font-size:14px;" placeholder="D√©taillez votre recette..."></textarea>

<button id="btn-pub" class="btn-publish">AJOUTER √Ä LA CARTE</button>

</div>

<script type="module">
    import { auth, db, ts } from './firebase-config.js';
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- LISTE EMOJI COMPL√àTE ---
    const categories = [
        "üçî Burgers", "ü•© Smash Burgers", "üçï Pizzas", "üåÆ Tacos", "üåØ Burritos", 
        "ü•ô Kebabs/Gyros", "üç± Sushis", "üçú Ramen/Wok", "ü•ñ Banh Mi", "ü•ó Salades/Poke", 
        "üçü Frites/Sides", "üçó Poulet Frit", "ü•® Terroir/Fermier", "ü•û Cr√™pes/Galettes", 
        "üçù P√¢tes", "üêü Fish & Chips", "ü•ò Plats Cuisin√©s", "üç© Desserts", "üç¶ Glaces", 
        "ü•§ Boissons", "‚òï Caf√©/Tea"
    ];

    let selectedCat = "üçî Burgers";
    let currentImg = "";

    document.getElementById('btn-back').onclick = () => window.location.href = 'gerant_dashboard.html';

    onAuthStateChanged(auth, user => {
        if (!user) window.location.href = 'gerant_auth.html';
    });

    function displayCats(list) {
        const container = document.getElementById('cat-container');
        container.innerHTML = "";
        list.forEach(c => {
            const chip = document.createElement('div');
            chip.className = 'cat-chip' + (selectedCat === c ? ' active' : '');
            chip.innerText = c;
            chip.onclick = () => { 
                selectedCat = c; 
                displayCats(categories); 
            };
            container.appendChild(chip);
        });
    }

    document.getElementById('cat-search').onkeyup = function() {
        const val = this.value.toLowerCase();
        const filtered = categories.filter(c => c.toLowerCase().includes(val));
        displayCats(filtered);
    };

    document.querySelectorAll('.label-box').forEach(box => {
        box.onclick = function() {
            this.classList.toggle('selected');
        };
    });

    document.getElementById('ia-box').onclick = function() {
        const loader = document.getElementById('ai-processing');
        const preview = document.getElementById('preview-img');
        const instruction = document.getElementById('instruction');
        
        loader.style.display = 'flex';
        setTimeout(() => {
            loader.style.display = 'none';
            instruction.style.display = 'none';
            preview.style.display = 'block';
            currentImg = "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=500";
            preview.src = currentImg;
        }, 1500);
    };

    document.getElementById('btn-pub').onclick = async function() {
        const user = auth.currentUser;
        if (!user) return alert("‚ùå Session expir√©e.");

        const name = document.getElementById('p-name').value.trim();
        const price = parseFloat(document.getElementById('p-price').value);
        const desc = document.getElementById('p-desc').value.trim();
        const btn = document.getElementById('btn-pub');

        if (!name || name.length < 3) return alert("‚ö†Ô∏è Nom trop court");
        if (!price || price <= 0) return alert("‚ö†Ô∏è Prix invalide");

        let labels = [];
        document.querySelectorAll('.label-box.selected').forEach(box => labels.push(box.innerText));

        btn.disabled = true;
        btn.innerText = "PUBLICATION...";

        try {
            await addDoc(collection(db, "menu"), {
                truckId: user.uid,
                name: name,
                price: price,
                desc: desc,
                category: selectedCat,
                labels: labels,
                image: currentImg || "https://via.placeholder.com/150",
                stock: true,
                createdAt: ts()
            });

            alert("üöÄ PRODUIT AJOUT√â !");
            window.location.href = 'gerant_carte.html';
        } catch (e) {
            alert("‚ùå Erreur : " + e.message);
            btn.disabled = false;
            btn.innerText = "AJOUTER √Ä LA CARTE";
        }
    };

    displayCats(categories);
</script>

</body>
</html>
